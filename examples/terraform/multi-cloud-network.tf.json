{
  "terraform": {
    "required_providers": {
      "aws": {
        "source": "hashicorp/aws",
        "version": "~> 5.0"
      },
      "azurerm": {
        "source": "hashicorp/azurerm",
        "version": "~> 3.0"
      }
    }
  },
  "provider": {
    "aws": {
      "region": "us-east-1",
      "alias": "aws_primary"
    },
    "azurerm": {
      "features": {},
      "alias": "azure_primary"
    }
  },
  "resource": {
    "aws_vpc": {
      "aws_vpc": {
        "provider": "aws.aws_primary",
        "cidr_block": "10.10.0.0/16",
        "enable_dns_hostnames": true,
        "enable_dns_support": true,
        "tags": {
          "Name": "aws-vpc",
          "Cloud": "AWS",
          "Environment": "production"
        }
      }
    },
    "aws_subnet": {
      "aws_public": {
        "provider": "aws.aws_primary",
        "vpc_id": "${aws_vpc.aws_vpc.id}",
        "cidr_block": "10.10.1.0/24",
        "availability_zone": "us-east-1a",
        "map_public_ip_on_launch": true,
        "tags": {
          "Name": "aws-public-subnet"
        }
      },
      "aws_private": {
        "provider": "aws.aws_primary",
        "vpc_id": "${aws_vpc.aws_vpc.id}",
        "cidr_block": "10.10.10.0/24",
        "availability_zone": "us-east-1a",
        "tags": {
          "Name": "aws-private-subnet"
        }
      }
    },
    "aws_internet_gateway": {
      "aws_igw": {
        "provider": "aws.aws_primary",
        "vpc_id": "${aws_vpc.aws_vpc.id}",
        "tags": {
          "Name": "aws-igw"
        }
      }
    },
    "aws_customer_gateway": {
      "azure": {
        "provider": "aws.aws_primary",
        "bgp_asn": 65000,
        "ip_address": "${azurerm_public_ip.vpn_gateway.ip_address}",
        "type": "ipsec.1",
        "tags": {
          "Name": "azure-customer-gateway"
        }
      }
    },
    "aws_vpn_gateway": {
      "main": {
        "provider": "aws.aws_primary",
        "vpc_id": "${aws_vpc.aws_vpc.id}",
        "tags": {
          "Name": "aws-vpn-gateway"
        }
      }
    },
    "aws_vpn_connection": {
      "aws_to_azure": {
        "provider": "aws.aws_primary",
        "vpn_gateway_id": "${aws_vpn_gateway.main.id}",
        "customer_gateway_id": "${aws_customer_gateway.azure.id}",
        "type": "ipsec.1",
        "static_routes_only": false,
        "tags": {
          "Name": "aws-to-azure-vpn"
        }
      }
    },
    "aws_security_group": {
      "web": {
        "provider": "aws.aws_primary",
        "name": "aws-web-sg",
        "description": "Security group for web servers in AWS",
        "vpc_id": "${aws_vpc.aws_vpc.id}",
        "ingress": [
          {
            "from_port": 443,
            "to_port": 443,
            "protocol": "tcp",
            "cidr_blocks": ["0.0.0.0/0"],
            "description": "HTTPS from internet"
          },
          {
            "from_port": 80,
            "to_port": 80,
            "protocol": "tcp",
            "cidr_blocks": ["0.0.0.0/0"],
            "description": "HTTP from internet"
          },
          {
            "from_port": 0,
            "to_port": 0,
            "protocol": "-1",
            "cidr_blocks": ["10.20.0.0/16"],
            "description": "All traffic from Azure"
          }
        ],
        "egress": [
          {
            "from_port": 0,
            "to_port": 0,
            "protocol": "-1",
            "cidr_blocks": ["0.0.0.0/0"]
          }
        ],
        "tags": {
          "Name": "aws-web-sg"
        }
      }
    },
    "aws_instance": {
      "web": {
        "provider": "aws.aws_primary",
        "ami": "ami-0c55b159cbfafe1f0",
        "instance_type": "t3.medium",
        "subnet_id": "${aws_subnet.aws_private.id}",
        "vpc_security_group_ids": ["${aws_security_group.web.id}"],
        "tags": {
          "Name": "aws-web-server",
          "Cloud": "AWS"
        }
      }
    },
    "azurerm_resource_group": {
      "main": {
        "provider": "azurerm.azure_primary",
        "name": "multi-cloud-resources",
        "location": "East US"
      }
    },
    "azurerm_virtual_network": {
      "azure_vnet": {
        "provider": "azurerm.azure_primary",
        "name": "azure-vnet",
        "address_space": ["10.20.0.0/16"],
        "location": "${azurerm_resource_group.main.location}",
        "resource_group_name": "${azurerm_resource_group.main.name}",
        "tags": {
          "Cloud": "Azure",
          "Environment": "production"
        }
      }
    },
    "azurerm_subnet": {
      "gateway": {
        "provider": "azurerm.azure_primary",
        "name": "GatewaySubnet",
        "resource_group_name": "${azurerm_resource_group.main.name}",
        "virtual_network_name": "${azurerm_virtual_network.azure_vnet.name}",
        "address_prefixes": ["10.20.0.0/24"]
      },
      "workload": {
        "provider": "azurerm.azure_primary",
        "name": "workload-subnet",
        "resource_group_name": "${azurerm_resource_group.main.name}",
        "virtual_network_name": "${azurerm_virtual_network.azure_vnet.name}",
        "address_prefixes": ["10.20.1.0/24"]
      }
    },
    "azurerm_public_ip": {
      "vpn_gateway": {
        "provider": "azurerm.azure_primary",
        "name": "azure-vpn-gateway-pip",
        "location": "${azurerm_resource_group.main.location}",
        "resource_group_name": "${azurerm_resource_group.main.name}",
        "allocation_method": "Static",
        "sku": "Standard"
      }
    },
    "azurerm_virtual_network_gateway": {
      "main": {
        "provider": "azurerm.azure_primary",
        "name": "azure-vpn-gateway",
        "location": "${azurerm_resource_group.main.location}",
        "resource_group_name": "${azurerm_resource_group.main.name}",
        "type": "Vpn",
        "vpn_type": "RouteBased",
        "active_active": false,
        "enable_bgp": true,
        "sku": "VpnGw1",
        "ip_configuration": {
          "name": "vnetGatewayConfig",
          "public_ip_address_id": "${azurerm_public_ip.vpn_gateway.id}",
          "private_ip_address_allocation": "Dynamic",
          "subnet_id": "${azurerm_subnet.gateway.id}"
        },
        "bgp_settings": {
          "asn": 65000
        }
      }
    },
    "azurerm_local_network_gateway": {
      "aws": {
        "provider": "azurerm.azure_primary",
        "name": "aws-local-gateway",
        "resource_group_name": "${azurerm_resource_group.main.name}",
        "location": "${azurerm_resource_group.main.location}",
        "gateway_address": "${aws_vpn_connection.aws_to_azure.tunnel1_address}",
        "address_space": ["10.10.0.0/16"],
        "bgp_settings": {
          "asn": 64512,
          "bgp_peering_address": "${aws_vpn_connection.aws_to_azure.tunnel1_bgp_asn}"
        }
      }
    },
    "azurerm_virtual_network_gateway_connection": {
      "azure_to_aws": {
        "provider": "azurerm.azure_primary",
        "name": "azure-to-aws-connection",
        "location": "${azurerm_resource_group.main.location}",
        "resource_group_name": "${azurerm_resource_group.main.name}",
        "type": "IPsec",
        "virtual_network_gateway_id": "${azurerm_virtual_network_gateway.main.id}",
        "local_network_gateway_id": "${azurerm_local_network_gateway.aws.id}",
        "shared_key": "shared-vpn-key-12345",
        "enable_bgp": true
      }
    },
    "azurerm_network_security_group": {
      "workload": {
        "provider": "azurerm.azure_primary",
        "name": "azure-workload-nsg",
        "location": "${azurerm_resource_group.main.location}",
        "resource_group_name": "${azurerm_resource_group.main.name}",
        "security_rule": [
          {
            "name": "allow-https",
            "priority": 100,
            "direction": "Inbound",
            "access": "Allow",
            "protocol": "Tcp",
            "source_port_range": "*",
            "destination_port_range": "443",
            "source_address_prefix": "*",
            "destination_address_prefix": "*"
          },
          {
            "name": "allow-from-aws",
            "priority": 110,
            "direction": "Inbound",
            "access": "Allow",
            "protocol": "*",
            "source_port_range": "*",
            "destination_port_range": "*",
            "source_address_prefix": "10.10.0.0/16",
            "destination_address_prefix": "*"
          }
        ]
      }
    },
    "azurerm_network_interface": {
      "app": {
        "provider": "azurerm.azure_primary",
        "name": "azure-app-nic",
        "location": "${azurerm_resource_group.main.location}",
        "resource_group_name": "${azurerm_resource_group.main.name}",
        "ip_configuration": {
          "name": "internal",
          "subnet_id": "${azurerm_subnet.workload.id}",
          "private_ip_address_allocation": "Dynamic"
        }
      }
    },
    "azurerm_linux_virtual_machine": {
      "app": {
        "provider": "azurerm.azure_primary",
        "name": "azure-app-vm",
        "resource_group_name": "${azurerm_resource_group.main.name}",
        "location": "${azurerm_resource_group.main.location}",
        "size": "Standard_D2s_v3",
        "admin_username": "azureuser",
        "network_interface_ids": ["${azurerm_network_interface.app.id}"],
        "admin_ssh_key": {
          "username": "azureuser",
          "public_key": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQD..."
        },
        "os_disk": {
          "caching": "ReadWrite",
          "storage_account_type": "Premium_LRS"
        },
        "source_image_reference": {
          "publisher": "Canonical",
          "offer": "0001-com-ubuntu-server-focal",
          "sku": "20_04-lts-gen2",
          "version": "latest"
        },
        "tags": {
          "Name": "azure-app-server",
          "Cloud": "Azure"
        }
      }
    }
  }
}
